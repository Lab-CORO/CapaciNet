---
title: Diagramme de Composants - Base Placement Plugin
---
graph TB
    subgraph RViz2["ğŸ–¼ï¸ RViz2 Environment"]
        rviz_core["RViz Core"]
        interactive_markers["Interactive Markers Server"]
        3d_view["Vue 3D"]
    end

    subgraph Plugin["ğŸ”Œ Base Placement Plugin"]
        subgraph UI["ğŸ’» Interface Utilisateur (Qt)"]
            panel["AddWayPoint<br/>(RViz Panel)<br/>â”â”â”â”â”â”â”â”<br/>ğŸ“ Placement waypoints<br/>ğŸ–±ï¸ Marqueurs interactifs"]
            widget["BasePlacementWidget<br/>(QWidget)<br/>â”â”â”â”â”â”â”â”<br/>âš™ï¸ Configuration<br/>ğŸ“Š RÃ©sultats<br/>ğŸ—‚ï¸ Gestion fichiers"]
            tree_model["PointTreeModel<br/>â”â”â”â”â”â”â”â”<br/>ğŸŒ³ HiÃ©rarchie waypoints<br/>ğŸ“‹ Vue en arbre"]
        end

        subgraph Core["âš™ï¸ Moteur de Calcul"]
            place_base["PlaceBase<br/>(QObject)<br/>â”â”â”â”â”â”â”â”<br/>ğŸ§  Algorithmes placement<br/>ğŸ“ Transformations<br/>ğŸ”¢ Calcul scores"]

            subgraph Algorithms["ğŸ“Š 5 Algorithmes"]
                pca["1ï¸âƒ£ PCA<br/>Analyse composantes"]
                grasp["2ï¸âƒ£ Grasp Reachability<br/>Score accessibilitÃ©"]
                ik["3ï¸âƒ£ IK Solutions<br/>CinÃ©matique inverse"]
                vertical["4ï¸âƒ£ Vertical Model<br/>Alignement vertical"]
                user["5ï¸âƒ£ User Intuition<br/>Guidage manuel"]
            end
        end

        subgraph Visualization["ğŸ¨ Visualisation"]
            create_marker["CreateMarker<br/>â”â”â”â”â”â”â”â”<br/>ğŸ¤– ModÃ¨les robots<br/>ğŸ¦¾ ModÃ¨les bras<br/>â¡ï¸ FlÃ¨ches"]
            add_robot_base["AddRobotBase<br/>â”â”â”â”â”â”â”â”<br/>ğŸ”µ Marqueurs bases<br/>ğŸ“ Positions optimales"]
        end

        subgraph Geometry["ğŸ“ Algorithmes GÃ©omÃ©triques"]
            sphere["SphereDiscretization<br/>â”â”â”â”â”â”â”â”<br/>ğŸ”® Fibonacci<br/>ğŸŒ€ ArchimÃ¨de<br/>ğŸ¯ Latitude/Longitude"]
        end

        subgraph DataStructures["ğŸ’¾ Structures de DonnÃ©es"]
            ws_sphere["WsSphere<br/>â”â”â”â”â”â”â”â”<br/>ğŸ“ Point central<br/>ğŸ“ Rayon ri<br/>ğŸ”„ Poses associÃ©es"]
            workspace["WorkSpace<br/>â”â”â”â”â”â”â”â”<br/>ğŸ—ºï¸ Collection sphÃ¨res<br/>ğŸ“Š RÃ©solution<br/>ğŸŒ Carte complÃ¨te"]
        end
    end

    subgraph ROS2["ğŸ¤– ROS2 Ecosystem"]
        node["rclcpp::Node<br/>â”â”â”â”â”â”â”â”<br/>ğŸ“¡ Communication<br/>ğŸ”„ Publishers/Subscribers"]
        tf2["TF2<br/>â”â”â”â”â”â”â”â”<br/>ğŸ”„ Transformations<br/>ğŸ“ Frames rÃ©fÃ©rence"]
        ik_service["IK Service<br/>(curobo_msgs)<br/>â”â”â”â”â”â”â”â”<br/>ğŸ¦¾ CinÃ©matique inverse<br/>âœ… Validation poses"]
        marker_topic["Topic: /visualization_marker_array<br/>â”â”â”â”â”â”â”â”<br/>ğŸ“Š MarkerArray messages"]
    end

    subgraph External["ğŸ“š BibliothÃ¨ques Externes"]
        qt["Qt5<br/>â”â”â”â”â”â”â”â”<br/>ğŸ–¼ï¸ GUI Framework<br/>ğŸ”„ Signals/Slots<br/>âš¡ QtConcurrent"]
        eigen["Eigen3<br/>â”â”â”â”â”â”â”â”<br/>ğŸ§® AlgÃ¨bre linÃ©aire<br/>ğŸ“ Matrices/Vecteurs<br/>ğŸ“Š PCA"]
        octomap["OctoMap<br/>â”â”â”â”â”â”â”â”<br/>ğŸ—ºï¸ Carte 3D<br/>ğŸ” RequÃªtes spatiales<br/>ğŸ¯ Octree"]
        pcl["PCL<br/>â”â”â”â”â”â”â”â”<br/>â˜ï¸ Point Cloud<br/>ğŸ” Nearest Neighbor<br/>ğŸŒ³ KD-Tree"]
        hdf5["HDF5/HighFive<br/>â”â”â”â”â”â”â”â”<br/>ğŸ’¾ Stockage donnÃ©es<br/>ğŸ“Š Reachability maps"]
    end

    subgraph Data["ğŸ“‚ Fichiers de DonnÃ©es"]
        reach_map["Reachability Map<br/>(fichier .h5)<br/>â”â”â”â”â”â”â”â”<br/>ğŸ—ºï¸ Poses accessibles<br/>ğŸ”® SphÃ¨res workspace<br/>ğŸ“ RÃ©solution"]
        waypoints_file["Waypoints<br/>(fichier YAML/JSON)<br/>â”â”â”â”â”â”â”â”<br/>ğŸ“ Poses cibles<br/>ğŸ¯ Points passage"]
    end

    %% ============================================================
    %% CONNEXIONS UI
    %% ============================================================
    panel -.->|"ğŸ”„ Qt Signals/Slots"| place_base
    widget -.->|"ğŸ”„ Qt Signals/Slots"| place_base
    widget -->|"owns"| place_base
    widget -->|"owns"| add_robot_base
    widget -->|"uses"| tree_model
    panel --> interactive_markers

    %% ============================================================
    %% CONNEXIONS ALGORITHMES
    %% ============================================================
    place_base --> pca
    place_base --> grasp
    place_base --> ik
    place_base --> vertical
    place_base --> user

    %% ============================================================
    %% CONNEXIONS GÃ‰OMÃ‰TRIE
    %% ============================================================
    place_base -->|"utilise"| sphere
    pca -->|"calculs PCA"| sphere
    grasp -->|"gÃ©nÃ©ration sphÃ¨res"| sphere

    %% ============================================================
    %% CONNEXIONS VISUALISATION
    %% ============================================================
    place_base -->|"crÃ©e marqueurs"| create_marker
    place_base -->|"envoie poses"| add_robot_base
    create_marker --> marker_topic
    add_robot_base --> interactive_markers

    %% ============================================================
    %% CONNEXIONS DONNÃ‰ES
    %% ============================================================
    place_base -->|"contient"| ws_sphere
    place_base -->|"gÃ¨re"| workspace
    ws_sphere -.->|"partie de"| workspace

    %% ============================================================
    %% CONNEXIONS ROS2
    %% ============================================================
    place_base --> node
    create_marker --> node
    add_robot_base --> node
    panel --> node
    place_base -->|"appelle service"| ik_service
    node --> tf2

    %% ============================================================
    %% CONNEXIONS BIBLIOTHÃˆQUES
    %% ============================================================
    widget --> qt
    place_base --> qt
    panel --> qt
    sphere --> eigen
    pca --> eigen
    sphere --> octomap
    grasp --> octomap
    sphere --> pcl
    grasp --> pcl

    %% ============================================================
    %% CONNEXIONS FICHIERS
    %% ============================================================
    widget -.->|"ğŸ“¥ charge"| reach_map
    reach_map -.->|"donnÃ©es"| hdf5
    widget -.->|"ğŸ’¾ sauvegarde/charge"| waypoints_file

    %% ============================================================
    %% CONNEXIONS RVIZ
    %% ============================================================
    interactive_markers --> 3d_view
    marker_topic --> rviz_core
    rviz_core --> 3d_view
    panel --> rviz_core

    %% ============================================================
    %% STYLES
    %% ============================================================
    classDef uiClass fill:#e1f5ff,stroke:#0288d1,stroke-width:2px
    classDef coreClass fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    classDef algoClass fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef vizClass fill:#e8f5e9,stroke:#388e3c,stroke-width:2px
    classDef rosClass fill:#fff9c4,stroke:#f9a825,stroke-width:2px
    classDef dataClass fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    classDef libClass fill:#e0e0e0,stroke:#616161,stroke-width:2px

    class panel,widget,tree_model uiClass
    class place_base coreClass
    class pca,grasp,ik,vertical,user algoClass
    class create_marker,add_robot_base,sphere vizClass
    class node,tf2,ik_service,marker_topic rosClass
    class ws_sphere,workspace,reach_map,waypoints_file dataClass
    class qt,eigen,octomap,pcl,hdf5 libClass
